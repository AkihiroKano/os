#!/bin/bash

# Проверка наличия параметра
if [ $# -ne 1 ]; then
    echo "Ошибка: укажите имя файла." >&2
    exit 1
fi

file="$1"
if [ ! -f "$file" ]; then
    echo "Ошибка: файл '$file' не существует." >&2
    exit 1
fi

trash_dir="$HOME/.trash"
log_file="$trash_dir/trash.log"

# Создание каталога .trash
mkdir -p "$trash_dir" || { echo "Ошибка: не удалось создать каталог $trash_dir." >&2; exit 1; }

# Создание жесткой ссылки
link_name=$(date +%s%N)
ln "$file" "$trash_dir/$link_name" || { echo "Ошибка: не удалось создать ссылку." >&2; exit 1; }

# Удаление исходного файла
rm "$file" || { echo "Ошибка: не удалось удалить файл." >&2; exit 1; }

# Запись в лог
echo "$(realpath "$file") $link_name" >> "$log_file"
echo "Файл '$file' перемещен в корзину."
