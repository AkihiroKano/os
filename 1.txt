#!/bin/bash
if [ $# -ne 1 ]; then
    echo "Ошибка: укажите имя файла." >&2
    exit 1
fi

file="$1"
if [ ! -e "$file" ]; then
    echo "Ошибка: файл '$file' не существует." >&2
    exit 1
fi

trash_dir="$HOME/.trash"
log_file="$trash_dir/trash.log"
mkdir -p "$trash_dir" || { echo "Ошибка: не удалось создать каталог $trash_dir." >&2; exit 1; }

link_name=$(date +%s%N)

if [ -f "$file" ]; then
    ln -- "$file" "$trash_dir/$link_name" || { echo "Ошибка: не удалось создать ссылку." >&2; exit 1; }
    rm -- "$file" || { echo "Ошибка: не удалось удалить файл." >&2; exit 1; }
else
    # Для директорий используем tar
    tar czf "$trash_dir/$link_name.tar.gz" -- "$file" || { echo "Ошибка: не удалось архивировать директорию." >&2; exit 1; }
    rm -r -- "$file" || { echo "Ошибка: не удалось удалить директорию." >&2; exit 1; }
fi

echo "$(realpath -- "$file")|$link_name|$(test -f "$file" && echo "file" || echo "dir")" >> "$log_file"
echo "'$file' перемещен в корзину."
